var d=(t,a,r)=>new Promise((i,c)=>{var u=s=>{try{l(r.next(s))}catch(o){c(o)}},f=s=>{try{l(r.throw(s))}catch(o){c(o)}},l=s=>s.done?i(s.value):Promise.resolve(s.value).then(u,f);l((r=r.apply(t,a)).next())});import{j as e,m as x,A as T,z as B}from"./ui-Dz3VGjCi.js";import{r as h}from"./vendor-DBl2kvvH.js";import{a as b,c as U,u as E}from"./useTelegramUser-BsW_Cs6Z.js";import{b as C,u as I,S as m,B as g,a as N,d as R}from"./index--vVcZAxM.js";import{C as p}from"./Card-DwVsL2rV.js";import{M as S}from"./Modal-BNPX02AU.js";const v={getInfo:()=>b.get("/referral/links").then(t=>t.data),getBenefits:()=>b.get("/referral/benefits").then(t=>t.data)},w="ai_pushka_bot",z=U(t=>({referralCode:"",referralUrl:"",stats:null,benefits:[],isLoading:!1,error:null,fetchReferralInfo:()=>d(void 0,null,function*(){t({isLoading:!0,error:null});try{const a=yield v.getInfo(),r=a.referralUrl||(w&&a.referralCode?`https://t.me/${w}?start=${a.referralCode}`:"");t({referralCode:a.referralCode,referralUrl:r,stats:a.stats,isLoading:!1})}catch(a){t({error:a instanceof Error?a.message:"Failed to load referral info",isLoading:!1})}}),fetchBenefits:()=>d(void 0,null,function*(){try{const a=yield v.getBenefits();t({benefits:a.benefits})}catch(a){t({error:a instanceof Error?a.message:"Failed to load benefits"})}})}));function A(){const[t,a]=h.useState(!1),r=h.useCallback(i=>d(this,null,function*(){try{return yield navigator.clipboard.writeText(i),a(!0),C("success"),setTimeout(()=>a(!1),2e3),!0}catch(c){return a(!1),!1}}),[]);return{copied:t,copy:r}}const P=()=>{const{t}=I(["referral","common"]),{isLoading:a}=E(),{referralUrl:r,stats:i,benefits:c,isLoading:u,fetchReferralInfo:f,fetchBenefits:l}=z(),{copy:s}=A(),[o,j]=h.useState(!1);h.useEffect(()=>{a||(f(),l())},[a,f,l]);const k=()=>d(void 0,null,function*(){N("light"),(yield s(r))&&(C("success"),B.success(t("common:copied")))}),L=()=>{N("medium");const n=t("referral:shareText"),y=`https://t.me/share/url?url=${encodeURIComponent(r)}&text=${encodeURIComponent(n)}`;R(y)};return u||a?e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(m,{className:"h-20 rounded-2xl",variant:"rectangular"}),e.jsxs("div",{className:"flex",style:{columnGap:12},children:[e.jsx(m,{className:"flex-1 h-20 rounded-2xl",variant:"rectangular"}),e.jsx(m,{className:"flex-1 h-20 rounded-2xl",variant:"rectangular"})]}),e.jsx(m,{className:"h-36 rounded-2xl",variant:"rectangular"})]}):e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},className:"text-center pt-2",children:[e.jsx("h1",{className:"text-white text-2xl font-bold",children:t("referral:title")}),e.jsx("p",{className:"text-gray-text mt-2 text-[15px] leading-relaxed px-2",children:t("referral:description")})]}),i&&e.jsxs(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.05},className:"grid grid-cols-3",style:{gap:12},children:[e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-gray-text text-xs uppercase tracking-wider",children:t("referral:stats.invited")}),e.jsx("p",{className:"text-white text-2xl font-bold mt-1",children:i.totalInvited})]}),e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-gray-text text-xs uppercase tracking-wider",children:t("referral:stats.earned")}),e.jsx("p",{className:"text-white text-2xl font-bold mt-1",children:i.totalEarned})]}),e.jsxs(p,{className:"text-center",children:[e.jsx("p",{className:"text-gray-text text-xs uppercase tracking-wider",children:t("referral:stats.bonus")}),e.jsxs("p",{className:"text-purple-primary text-2xl font-bold mt-1",children:[i.currentTierBonus,"%"]})]})]}),e.jsxs(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.1},children:[e.jsx("h2",{className:"text-white text-lg font-bold mb-3",children:t("referral:yourLink")}),e.jsxs(p,{className:"space-y-3",children:[r?e.jsx("p",{className:"text-white text-sm font-mono break-all bg-dark-border/50 rounded-lg px-3 py-2",children:r}):e.jsx("div",{className:"bg-dark-border/50 rounded-lg px-3 py-2",children:e.jsx(m,{variant:"text",className:"h-5 w-full rounded"})}),e.jsxs("div",{className:"flex",style:{columnGap:8},children:[e.jsx(g,{variant:"primary",fullWidth:!0,size:"sm",onClick:L,disabled:!r,children:t("referral:share")}),e.jsx(g,{variant:"secondary",fullWidth:!0,size:"sm",onClick:k,disabled:!r,children:t("referral:copyLink")})]})]})]}),e.jsx(x.div,{initial:{y:20,opacity:0},animate:{y:0,opacity:1},transition:{delay:.15},children:e.jsx(g,{variant:"secondary",fullWidth:!0,onClick:()=>j(!0),children:t("referral:benefits")})}),e.jsx(S,{isOpen:o,onClose:()=>j(!1),title:t("referral:benefits"),size:"sm",children:e.jsx("div",{className:"p-4 space-y-3 pb-8",children:e.jsx(T,{children:c.map((n,y)=>e.jsxs(x.div,{initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{delay:y*.05},className:"flex items-center p-3 rounded-xl bg-white/5 border border-white/10",style:{columnGap:12},children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-brand-primary/15 flex items-center justify-center shrink-0",children:e.jsxs("span",{className:"text-brand-primary font-bold text-sm",children:[n.percentage,"%"]})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-white font-semibold text-sm",children:n.name}),e.jsx("p",{className:"text-content-tertiary text-xs mt-0.5",children:t("referral:bonusDescription",{percentage:n.percentage})})]})]},n.tier))})})})]})};export{P as default};

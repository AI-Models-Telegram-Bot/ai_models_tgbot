var V=(a,c,l)=>new Promise((r,s)=>{var d=i=>{try{o(l.next(i))}catch(m){s(m)}},u=i=>{try{o(l.throw(i))}catch(m){s(m)}},o=i=>i.done?r(i.value):Promise.resolve(i.value).then(d,u);o((l=l.apply(a,c)).next())});import{j as e,m as z,z as S}from"./ui-Dz3VGjCi.js";import{r as n}from"./vendor-DBl2kvvH.js";import{u as F}from"./useTelegramUser-BsW_Cs6Z.js";import{u as A,g as U,S as N,a as w,b as R,e as L}from"./index--vVcZAxM.js";import{u as O}from"./audioSettingsStore-U73_cNab.js";import{C as W}from"./Card-DwVsL2rV.js";const q=["all","premade","cloned","generated"];function B({voice:a,isSelected:c,onSelect:l}){var x,f,j;const{t:r}=A("audio"),s=n.useRef(null),[d,u]=n.useState(!1),o=p=>{if(p.stopPropagation(),!a.previewUrl)return;if(w("light"),d&&s.current){s.current.pause(),s.current.currentTime=0,u(!1);return}s.current&&s.current.pause();const y=new Audio(a.previewUrl);s.current=y,y.play().catch(()=>{}),u(!0),y.onended=()=>u(!1)},i=(x=a.labels)==null?void 0:x.gender,m=(f=a.labels)==null?void 0:f.age,b=(j=a.labels)==null?void 0:j.accent;return e.jsx(z.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},onClick:()=>{w("light"),l()},className:`rounded-xl p-3 cursor-pointer transition-all ${c?"bg-audio-surface-elevated border-2 border-audio-primary shadow-audio-neon":"bg-audio-surface-card border border-white/5 hover:border-audio-primary/30"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center",style:{columnGap:8},children:[e.jsx("span",{className:"font-semibold text-content-primary text-sm truncate",children:a.name}),c&&e.jsx("span",{className:"text-xs px-2 py-0.5 rounded-full bg-audio-primary/20 text-audio-primary font-medium shrink-0",children:r("selected")})]}),e.jsxs("div",{className:"flex items-center text-xs text-content-tertiary mt-1",style:{columnGap:6},children:[i&&e.jsx("span",{className:"capitalize",children:i}),m&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsx("span",{className:"capitalize",children:m})]}),b&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"Â·"}),e.jsx("span",{className:"capitalize",children:b})]})]})]}),a.previewUrl&&e.jsx("button",{onClick:o,className:`shrink-0 w-9 h-9 rounded-full flex items-center justify-center transition-colors ${d?"bg-audio-primary text-white":"bg-white/5 text-content-secondary hover:bg-audio-primary/20 hover:text-audio-primary"}`,children:d?"â¸":"â–¶"})]})})}function Y(){const{t:a}=A("audio"),{telegramId:c,isLoading:l}=F(),{elevenLabsSettings:r,voices:s,voicesLoading:d,isLoading:u,isSaving:o,error:i,fetchSettings:m,updateElevenLabs:b,fetchVoices:x}=O(),[f,j]=n.useState(""),[p,y]=n.useState("all"),[g,I]=n.useState(null),C=n.useRef(null);n.useEffect(()=>{x()},[]),n.useEffect(()=>{var h,v;const t=c||((v=(h=U())==null?void 0:h.id)==null?void 0:v.toString());t&&m(t)},[c]),n.useEffect(()=>{r!=null&&r.voiceId&&I(r.voiceId)},[r]);const P=n.useCallback(t=>{j(t),C.current&&clearTimeout(C.current),C.current=setTimeout(()=>{x(t||void 0,p!=="all"?p:void 0)},300)},[p]),$=t=>{y(t),w("light"),x(f||void 0,t!=="all"?t:void 0)},G=()=>V(this,null,function*(){var v,E;const t=c||((E=(v=U())==null?void 0:v.id)==null?void 0:E.toString());if(!t||!g){S.error(a("saveError"));return}w("medium");const h=s.find(T=>T.voiceId===g);try{yield b(t,{voiceId:g,voiceName:(h==null?void 0:h.name)||"Unknown"}),R("success"),S.success(a("saved")),setTimeout(()=>L(),800)}catch(T){R("error"),S.error(a("saveError"))}});if(l||u)return e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsx(N,{className:"h-16",variant:"rectangular"}),e.jsx(N,{className:"h-10",variant:"rectangular"}),e.jsx(N,{className:"h-64",variant:"rectangular"})]});const k=g!==(r==null?void 0:r.voiceId);return e.jsxs("div",{className:"flex flex-col min-h-screen",children:[e.jsxs("div",{className:"flex-1 p-4 pb-24",children:[e.jsx(z.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-5",children:e.jsxs("h1",{className:"text-xl font-display font-bold text-content-primary",children:[e.jsx("span",{className:"text-audio-primary",children:"ðŸŽ™ï¸"})," ",a("voiceSettings")]})}),e.jsx(W,{className:"mb-4 !bg-audio-surface-card border border-audio-primary/20",children:e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"text-xs text-content-tertiary uppercase tracking-wide mb-1",children:a("currentVoice")}),e.jsx("div",{className:"text-sm font-medium text-audio-primary-light",children:(r==null?void 0:r.voiceName)||a("noVoiceSelected")})]})}),e.jsx("div",{className:"mb-3",children:e.jsx("input",{type:"text",value:f,onChange:t=>P(t.target.value),placeholder:a("searchVoices"),className:"w-full px-4 py-2.5 rounded-xl bg-audio-surface-card border border-white/10 text-content-primary placeholder-content-tertiary text-sm focus:outline-none focus:border-audio-primary focus:ring-1 focus:ring-audio-primary/30 transition-colors"})}),e.jsxs("div",{className:"flex mb-4 overflow-x-auto scrollbar-hide",style:{columnGap:8},children:[q.map(t=>e.jsx("button",{onClick:()=>$(t),className:`px-3 py-1.5 rounded-full text-xs font-medium whitespace-nowrap transition-colors ${p===t?"bg-audio-primary text-white":"bg-white/5 text-content-secondary hover:bg-white/10"}`,children:a(`filter${t.charAt(0).toUpperCase()+t.slice(1)}`)},t)),!d&&e.jsx("span",{className:"px-3 py-1.5 text-xs text-content-tertiary whitespace-nowrap",children:a("voicesCount",{count:s.length})})]}),d?e.jsx("div",{className:"space-y-2",children:[1,2,3,4,5].map(t=>e.jsx(N,{className:"h-16",variant:"rectangular"},t))}):i&&s.length===0?e.jsxs("div",{className:"text-center py-10",children:[e.jsx("p",{className:"text-red-400 text-sm mb-3",children:i}),e.jsx("button",{onClick:()=>x(),className:"px-4 py-2 rounded-xl bg-audio-primary/20 text-audio-primary text-sm font-medium hover:bg-audio-primary/30 transition-colors",children:a("retry","Retry")})]}):s.length===0?e.jsx("div",{className:"text-center text-content-tertiary py-10 text-sm",children:a("noVoicesFound")}):e.jsx("div",{className:"space-y-2",children:s.map(t=>e.jsx(B,{voice:t,isSelected:g===t.voiceId,onSelect:()=>I(t.voiceId)},t.voiceId))})]}),e.jsx("div",{className:"fixed bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-audio-surface via-audio-surface to-transparent pt-8",children:e.jsx("button",{onClick:G,disabled:!k||o,className:`w-full py-3 rounded-xl font-semibold text-sm transition-all ${k&&!o?"bg-audio-primary text-white shadow-audio-neon hover:bg-audio-primary-dark active:scale-[0.98]":"bg-white/5 text-content-tertiary cursor-not-allowed"}`,children:a(o?"saving":"save")})})]})}export{Y as default};
